{% extends 'base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/cart.css' %}">
{% endblock %}

{% block content %}
    <main>
        <div class="container">
            <div class="cart-container">

                <div class="cart-container__items" id="cart-js" style="padding-left: 40px">

                    {% if not cart_items %}
                        <div class="text-center no-items-msg">
                            <h1>No items in your cart</h1>
                            <a href="{% url 'store' %}">
                                <i class="fa-solid fa-arrow-left-long"></i>
                                <span>Continue shopping</span>
                            </a>
                        </div>
                    {% else %}

                        <div class="row" style="margin-bottom: 20px; margin-top: 15px">

                            <div class="col-lg-5"> <span class="card-body__headers">product</span> </div>
                            <div class="col-lg-3"> <span class="card-body__headers">quantity</span> </div>
                            <div class="col-lg-2"> <span class="card-body__headers">price</span> </div>

                        </div>

                        {% for cart_item in cart_items %}

                            <div class="row cartItem-js" style="margin-bottom: 30px">

                                <div class="col-lg-5" style="display: flex; flex-direction: row">
                                    <div class="cart-container__items-item__img" style="padding-right: 40px">
                                        <a href="{{ cart_item.product.get_absolute_url }}" style="color: #000 !important; text-decoration: none">
                                            <img style="max-height: 150px; width: auto; border-radius: 5px" src="{{ cart_item.product.poster.url }}" alt="">
                                        </a>
                                    </div>

                                    <div class="cart-container__items-item__desc">
                                        <a href="{{ cart_item.product.get_absolute_url }}" style="color: #000 !important; text-decoration: none">
                                            <span class="product-name" style="display: inline-block; font-size: 20px; margin-bottom: 8px;">{{ cart_item.product.name }}</span>
                                        </a>
                                        <span class="product-size" style="display: inline-block; margin-bottom: 9px; font-size: 18px;">size:
                                            {% for var in cart_item.variation.all %}
                                                {{ var.variation_value }}
                                            {% endfor %}
                                        </span>
                                        <span class="product-category" style="font-size: 18px;">{{ cart_item.product.category }}</span>
                                    </div>
                                </div>
                                <div class="col-lg-3" style="display: flex; flex-direction: row">


                                    <div class="cart-container__items-item__qty btn-group" role="group">
                                        <a href="{% url 'remove_cart' cart_item.product.id cart_item.id %}" type="button" class="btn" style="border-radius: 0.375rem 0 0 0.375rem; border-right: 0 !important">
                                            <span>-</span>
                                        </a>

                                        <button type="button" class="btn counter" disabled><span>{{ cart_item.qty }}</span></button>

                                        <form action="{% url 'add_cart' cart_item.product.id %}" method="POST">
                                            {% csrf_token %}
                                            {% for item in cart_item.variation.all %}
                                                <input type="hidden" name="{{ item.variation_category | lower }}" value="{{ item.variation_value | capfirst }}">
                                            {% endfor %}

                                            <button type="submit" class="btn" style="border-radius: 0 0.375rem 0.375rem 0; border-left: 0 !important;">
                                                <span>+</span>
                                            </button>
                                        </form>
                                    </div>
                                </div>

                                <div class="col-lg-2" style="display: flex; flex-direction: row">
                                    <span class="cart-container__items-item__price__total" style="font-size: 19px;">{{ cart_item.product.price }} RUB</span>

                                </div>

                                <div class="cart-container__items-item__delete col-lg-1">
                                    <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" onclick="return confirm('Are you sure you want to delete this item?')">
                                        <i class="fa-solid fa-trash-can"></i>
                                    </a>
                                </div>

                            </div>

                        {% endfor %}

                    {% endif %}


                </div>


                <div class="cart-container__payments">
                    <div class="cart-container__payments-total">
                        <div class="cart-container__payments-total__info">
                            <span>price:</span><span>{{ total }} RUB</span>
                        </div>
                        <div class="cart-container__payments-total__info">
                            <span>tax:</span><span>{{ tax }} RUB</span>
                        </div>
                        <div class="cart-container__payments-total__info">
                            <span><b>total:</b></span><span><b>{{ grand_total }} RUB</b></span>
                        </div>
                    </div>

                    <a href="{% url 'checkout' %}" role="button" class="cart-container__payments-button" style="text-decoration: none">
                        <span>checkout</span>
                    </a>

                    <a href="{% url 'store' %}" class="cart-container__payments-link">
                        <i class="fa-solid fa-arrow-left-long"></i>
                        <span>back to shopping</span>
                    </a>
                </div>
            </div>
        </div>
    </main>

    <div class="error" style="position: absolute; bottom: 10%; right: 10%; max-width: 200px">
        {% include 'include/alerts.html' %}
    </div>

{% endblock %}

{% block js %}
    <script src="{% static 'js/script2.js' %}"></script>
{% endblock %}