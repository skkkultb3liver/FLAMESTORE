{% extends 'base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/cart.css' %}">
{% endblock %}

{% block content %}
    <main>
        <div class="container">
            <div class="cart-container">

                <div class="cart-container__items" id="cart-js">

                    {% if not cart_items %}
                        <div class="text-center no-items-msg">
                            <h1>No items in your cart</h1>
                            <a href="{% url 'store' %}">
                                <i class="fa-solid fa-arrow-left-long"></i>
                                <span>Continue shopping</span>
                            </a>
                        </div>
                    {% else %}

                        <div class="cart-container__items-header">
                            <span>product</span>
                            <span>quantity</span>
                            <span>price</span>
                        </div>


                        {% for cart_item in cart_items %}
                            <div class="cart-container__items-item cartItem-js">
                                <div class="cart-container__items-item__img">
                                    <a href="{{ cart_item.product.get_absolute_url }}" style="color: #000 !important; text-decoration: none">
                                        <img style="max-height: 130px; width: auto; border-radius: 5px" src="{{ cart_item.product.poster.url }}" alt="">
                                    </a>
                                </div>

                                <div class="cart-container__items-item__desc">
                                    <a href="{{ cart_item.product.get_absolute_url }}" style="color: #000 !important; text-decoration: none">
                                        <span class="product-name">{{ cart_item.product.name }}</span>
                                    </a>
                                    <span class="product-size">size:
                                        {% for var in cart_item.variation.all %}
                                            {{ var.variation_value }}
                                        {% endfor %}
                                    </span>
                                    <span class="product-category">{{ cart_item.product.category }}</span>
                                </div>

                                <div class="cart-container__items-item__qty btn-group" role="group">
                                    <a href="{% url 'remove_cart' cart_item.product.id cart_item.id %}" type="button" class="btn" style="border-radius: 0.375rem 0 0 0.375rem; border-right: 0 !important">
                                        <span>-</span>
                                    </a>

                                    <button type="button" class="btn counter" disabled><span>{{ cart_item.qty }}</span></button>

                                    <form action="{% url 'add_cart' cart_item.product.id %}" method="POST">
                                        {% csrf_token %}
                                        {% for item in cart_item.variation.all %}
                                            <input type="hidden" name="{{ item.variation_category | lower }}" value="{{ item.variation_value | capfirst }}">
                                        {% endfor %}

                                        <button type="submit" class="btn" style="border-radius: 0 0.375rem 0.375rem 0; border-left: 0 !important;">
                                            <span>+</span>
                                        </button>
                                    </form>
                                </div>

                                <div class="cart-container__items-item__price">
                                    <span class="cart-container__items-item__price__total">{{ cart_item.sub_total }} rub</span>
                                    <span class="cart-container__items-item__price__foreach">{{ cart_item.product.price }} rub for each</span>
                                </div>

                                <div class="cart-container__items-item__delete">
                                    <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" onclick="return confirm('Are you sure you want to delete this item?')">
                                        <i class="fa-solid fa-trash-can"></i>
                                    </a>
                                </div>

                            </div>
                        {% endfor %}

                    {% endif %}


                </div>


                <div class="cart-container__payments">
                    <div class="cart-container__payments-total">
                        <div class="cart-container__payments-total__info">
                            <span>price:</span><span>{{ total }} RUB</span>
                        </div>
                        <div class="cart-container__payments-total__info">
                            <span>tax:</span><span>{{ tax }} RUB</span>
                        </div>
                        <div class="cart-container__payments-total__info">
                            <span><b>total:</b></span><span><b>{{ grand_total }} RUB</b></span>
                        </div>
                    </div>

                    <button class="cart-container__payments-button">
                        <span>checkout</span>
                    </button>

                    <a href="{% url 'store' %}" class="cart-container__payments-link">
                        <i class="fa-solid fa-arrow-left-long"></i>
                        <span>back to shopping</span>
                    </a>
                </div>
            </div>
        </div>
    </main>

{% endblock %}

{% block js %}
    <script src="{% static 'js/script2.js' %}"></script>
{% endblock %}